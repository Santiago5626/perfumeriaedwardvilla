name: Keep Server Alive

on:
  schedule:
    # Se ejecuta cada 14 minutos entre las 6 AM y 11:59 PM (hora de Colombia UTC-5)
    # Convertido a UTC: 11 AM - 4:59 AM del d√≠a siguiente
    - cron: '*/5 11-23 * * *'  # De 6 AM a 6:59 PM (Colombia)
    - cron: '*/5 0-4 * * *'     # De 7 PM a 11:59 PM (Colombia)
  workflow_dispatch: # Permite ejecutar manualmente

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Hacer ping al servidor
        run: |
          # Obtener hora actual en Colombia (UTC-5)
          CURRENT_HOUR=$(TZ=America/Bogota date +%H)
          echo "Hora actual en Colombia: $CURRENT_HOUR:00"
          
          # Verificar si estamos en horario permitido (6 AM - 12 AM)
          if [ $CURRENT_HOUR -ge 6 ] || [ $CURRENT_HOUR -lt 0 ]; then
            echo "Horario permitido. Haciendo ping..."
            response=$(curl -s -o /dev/null -w "%{http_code}" https://perfumeria-app.onrender.com/ping)
            echo "Respuesta del servidor: $response"
            
            if [ $response -eq 200 ]; then
              echo "‚úÖ Servidor respondi√≥ correctamente"
            else
              echo "‚ö†Ô∏è Servidor respondi√≥ con c√≥digo: $response"
            fi
          else
            echo "üåô Fuera del horario permitido. No se hace ping."
          fi
